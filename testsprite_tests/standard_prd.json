{
  "meta": {
    "project": "ChronosSystem",
    "date": "2025-11-04",
    "prepared_by": "Software Development Manager"
  },
  "product_overview": "ChronosSystem is a comprehensive, secure, and modern electronic attendance registration system tailored for interns. It incorporates advanced security measures including HMAC-signed QR codes, nonce-based anti-replay protection, immutable hash chain auditing, two-factor authentication (2FA), and robust user management, providing both administrative and user-facing interfaces optimized for desktop and mobile environments.",
  "core_goals": [
    "Implement a secure, scalable, and reliable attendance tracking system for interns.",
    "Provide easy-to-use authentication methods including credentials, Google OAuth, and optional 2FA.",
    "Ensure QR codes used for attendance are secure, unique, and time-limited to prevent fraud.",
    "Maintain immutable audit trails via hash chains and comprehensive audit logs.",
    "Support user roles with fine-grained access control (Admin, Supervisor, Intern, Auditor).",
    "Deliver modern, responsive interfaces for admins, interns (PWA), and kiosks.",
    "Enable offline PWA functionality with installation support and caching.",
    "Provide comprehensive APIs supporting all system operations.",
    "Implement advanced features like workload control, absence justification, and attendance corrections with approval workflows."
  ],
  "key_features": [
    "Secure Authentication System using NextAuth.js with credentials, Google OAuth, and 2FA (TOTP).",
    "QR Code Scanner and Rotating Kiosk display with codes signed by HMAC-SHA256 and nonce-based anti-replay protection.",
    "Immutable attendance records with hash chaining for audit integrity.",
    "Comprehensive user and machine management dashboards for Admin and Supervisor roles.",
    "PWA for interns with offline capability, geolocation, and QR scanning.",
    "Attendance recording with entry/exit validation, geolocation capture, optional selfie upload, and blockchain-style audit chaining.",
    "Rich auditing logs for security and operational oversight.",
    "Workload management system tracking contract hours, daily/weekly limits, intervals, and projections.",
    "Absence justification module allowing interns to submit reasons with external document links and supervisors to approve or reject.",
    "Correction request workflows with supervisory approval.",
    "Health check endpoints and rate limiting across APIs.",
    "Role based authorization and secure data handling.",
    "Automated QR code regeneration and management for kiosks."
  ],
  "user_flow_summary": [
    "Users authenticate via email/password or Google OAuth with optional 2FA setup and verification.",
    "Admins manage users, machines, and review audit logs via the Admin Dashboard.",
    "Kiosk machines display rotating QR codes that interns scan on their mobile PWA.",
    "Interns log attendance by scanning QR codes, optionally capturing geolocation data and selfies.",
    "Attendance entries are validated for time, nonce uniqueness, and sequence correctness before storage.",
    "Users can view personal attendance history and submit correction or absence justifications.",
    "Supervisors review and approve or reject justifications and corrections.",
    "System continuously tracks workload compliance and alerts on violations.",
    "Admins and auditors verify attendance log integrity via hash chain validation endpoints.",
    "PWA provides offline functionality, installation prompts, and seamless user experience across devices."
  ],
  "validation_criteria": [
    "Successful user authentication with valid credentials and Google OAuth including 2FA flows where enabled.",
    "QR codes generated with valid HMAC signatures, able to be scanned and validated with nonce anti-replay enforcement.",
    "Attendance records must maintain immutable hash chain continuity with verifiable prevHash and recordHash fields.",
    "Admin and Supervisor users must be able to create, update, deactivate users and machines, and view audit logs.",
    "Intern users can successfully scan QR codes and register attendance entries following ENTRADA/SAIDA sequence rules.",
    "All endpoints should enforce rate limits and return appropriate error codes on violations.",
    "Absence justifications and correction requests follow business rules, allowing only pending records to be edited and approved/rejected by authorized roles.",
    "Frontend PWAs must work offline with service worker caching and installation prompt behavior as specified.",
    "Security headers, CORS settings, and encryption implementations must pass vulnerability scans.",
    "End-to-end tests cover core flows: authentication, QR scanning, attendance recording, workload management, and justification approval.",
    "Code does not use insecure 'as any' casting in critical 2FA operations, utilizing type-safe helpers as implemented.",
    "Successful deployment and operation in Docker and cloud environments with monitoring and health check endpoints.",
    "Visual accessibility standards met with adequate contrast in UI inputs and components.",
    "Comprehensive test coverage demonstrated by passing unit and integration tests for security features and work hours calculations."
  ],
  "code_summary": {
    "tech_stack": [
      "TypeScript",
      "Next.js",
      "React",
      "Prisma",
      "PostgreSQL",
      "NextAuth.js",
      "TailwindCSS",
      "html5-qrcode"
    ],
    "features": [
      {
        "name": "Authentication System",
        "description": "Complete authentication system with NextAuth.js, supporting multiple providers and role-based access",
        "files": [
          "lib/auth.ts",
          "app/api/auth/[...nextauth]/route.ts",
          "app/auth/signin/page.tsx",
          "app/auth/complete-profile/page.tsx"
        ]
      },
      {
        "name": "QR Code Scanner",
        "description": "QR code scanning functionality for attendance registration using html5-qrcode library",
        "files": [
          "app/employee/page.tsx",
          "lib/qr-security.ts"
        ]
      },
      {
        "name": "Attendance Management",
        "description": "Complete attendance tracking system with entry/exit registration and history",
        "files": [
          "app/api/attendance/simple-register/route.ts",
          "app/api/machines/generate-qr/route.ts",
          "prisma/schema.prisma"
        ]
      },
      {
        "name": "Employee Dashboard",
        "description": "Employee interface for registering attendance and viewing records",
        "files": [
          "app/employee/page.tsx"
        ]
      },
      {
        "name": "Admin Dashboard",
        "description": "Administrative interface for managing users, machines and viewing statistics",
        "files": [
          "app/admin/page.tsx"
        ]
      },
      {
        "name": "User Management",
        "description": "User profile completion and management system",
        "files": [
          "app/auth/complete-profile/page.tsx",
          "app/api/auth/complete-profile/route.ts"
        ]
      },
      {
        "name": "Database Schema",
        "description": "Complete database schema with users, attendance records, machines and audit logs",
        "files": [
          "prisma/schema.prisma",
          "prisma/migrations/"
        ]
      }
    ]
  }
}
